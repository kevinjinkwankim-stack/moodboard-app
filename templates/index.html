<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moodboard Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2em;
      max-width: 800px;
      margin: auto;
      background: #f9f9f9;
    }
    h1 { text-align: center; }
    input, button {
      width: 100%;
      padding: 0.8em;
      margin-top: 1em;
    }
    #frames {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 2em;
    }
    .frame {
      position: relative;
    }
    .frame img {
      width: 200px;
      border: 1px solid #ccc;
    }
    .frame input[type="checkbox"] {
      position: absolute;
      top: 8px;
      left: 8px;
      transform: scale(1.4);
    }
  </style>
</head>
<body>
  <h1>Moodboard Generator</h1>
  <form id="upload-form" enctype="multipart/form-data">
    <input type="text" name="name" placeholder="Project Name" required />
    <input type="text" name="url" placeholder="YouTube URL (optional)" />
    <input type="file" name="video" />
    <button type="submit">Generate Moodboard</button>
  </form>

  <div class="buttons">
    <button onclick="downloadSelected()">Download Selected</button>
    <button onclick="downloadAll()">Download All</button>
  </div>

  <div id="frames"></div>

  <script>
    const form = document.getElementById('upload-form');
    const framesDiv = document.getElementById('frames');
    let currentProject = "";

    form.onsubmit = async (e) => {
      e.preventDefault();
      framesDiv.innerHTML = "Processing...";

      const formData = new FormData(form);
      const res = await fetch("/upload", {
        method: "POST",
        body: formData
      });

      const data = await res.json();

      if (data.error) {
        framesDiv.innerHTML = `<p style="color:red">${data.error}<br>${data.details || ''}</p>`;
        return;
      }

      currentProject = data.project;
      framesDiv.innerHTML = "";

      data.frames.forEach(path => {
        const frame = document.createElement("div");
        frame.className = "frame";
        frame.innerHTML = `
          <input type="checkbox" value="${path}">
          <img src="/static/${path}" alt="frame">
        `;
        framesDiv.appendChild(frame);
      });
    };

    function downloadAll() {
      if (!currentProject) return;
      window.location.href = "/download_zip/" + currentProject;
    }

    function downloadSelected() {
      const selected = Array.from(document.querySelectorAll('.frame input:checked')).map(cb => cb.value);
      if (selected.length === 0) return;
      const zipName = prompt("Name your zip file:", "selected_frames");
      fetch("/download_selected", {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ files: selected, zip_name: zipName })
      }).then(res => res.blob())
        .then(blob => {
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = zipName + ".zip";
          link.click();
        });
    }
  </script>
</body>
</html>
